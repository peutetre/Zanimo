(function(c){typeof exports==="object"?module.exports=c():Zanimo=c()})(function(){return function(){var c=window.Q||require("q");if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var d=function(a){var b=/(\(.+?\))/g,f=/^0px$/g,d=/ /g,e=/\-([a-z])/g,g="transitionend",c="transition",h=null,i=null,
n="opacity 100ms linear 0s",r=function(a,b,d){return a+" "+b+"ms "+(d||"linear")},j={transform:""},k=function(a,b){return b.toUpperCase()},t=function(a){var b=[];a.substr(1,a.length-2).split(",").forEach(function(a){b.push(a.replace(d,"").replace(f,"0"))});return"("+b.join(",")+")"},o=function(a){return(a[0]==="-"?a.substr(1,a.length-1):a).replace(e,k)},p=function(a){return a===null||a===void 0?"":isNaN(a)?a.replace(b,t):a.toString()};"WebkitTransition"in a.body.style&&(g="webkitTransitionEnd",h=
"webkit");for(var q in j)j[q]=h?"-"+h+"-"+q:q;c=o(h?h+"-"+c:c);i=a.createElement("div");n=p(n);i.style[c]=n;i=p(i.style[c]);i===n&&(r=function(a,b,d){return a+" "+b+"ms "+(d||"linear")+" 0s"});return{t:c,transform:o(j.transform),transitionend:g,norm:o,prefix:function(a){return j[a]?j[a]:a},repr:r,normValue:p}}(window.document),e=function(a){return a instanceof HTMLElement?c.resolve(a):c.isPromise(a)?a.then(e):c.reject(Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))},k=function(a,
b,f,c,e){b=d.prefix(b);a.style[d.t]=a.style[d.t]?a.style[d.t]+", "+d.repr(b,c,e):d.repr(b,c,e);a.style[d.norm(b)]=f};e.transition=function(a,b,f,e,s){var g=c.defer(),m,h=function(c){m&&(clearTimeout(m),m=null);d.prefix(b);var f=Object.keys(a._zanimo);f.length===1&&f[0]===b&&(a.style[d.t]="");a.removeEventListener(d.transitionend,i);c&&delete a._zanimo[b]},i=function(f){d.norm(f.propertyName)===d.norm(d.prefix(b))&&(h(!0),g.resolve(a))};if(!(a instanceof HTMLElement))return g.reject(Error("Zanimo transition: no DOM element!")),
g.promise;if(window.isNaN(parseInt(e,10)))return g.reject(Error("Zanimo transition: duration must be an integer!")),g.promise;a.addEventListener(d.transitionend,i);window.requestAnimationFrame(function(){k(a,b,f,e,s);m=setTimeout(function(){var c=a.style.getPropertyValue(d.prefix(b)),c=d.normValue(c),e=d.normValue(f);h(!0);c===e?g.resolve(a):g.reject(Error("Zanimo transition: "+a.id+" with "+b+" = "+e+", DOM value="+c))},e+20);a._zanimo=a._zanimo||{};a._zanimo[b]&&(a._zanimo[b].defer.reject(Error("Zanimo transition "+
a.id+" with "+b+"="+a._zanimo[b].value+" stopped by transition with "+b+"="+f)),a._zanimo[b].cb());a._zanimo[b]={cb:h,value:f,defer:g}},a);return g.promise};e.transitionf=function(a,b,c,d){return function(k){return e.transition(k,a,b,c,d)}};e.transform=function(a,b,e){var l=c.defer();if(!(a instanceof HTMLElement))return l.reject(Error("Zanimo transform: no DOM element!")),l.promise;a._zanimo&&a._zanimo.hasOwnProperty("transform")&&(a._zanimo.transform.defer.reject(Error("Zanimo transition "+a.id+
" with transform="+a._zanimo.transform.value+" stopped by transform="+b)),a._zanimo.transform.cb());window.requestAnimationFrame(function(){a.style[d.transform]=!e?a.style[d.transform]+" "+b:b;l.resolve(a)},a);return l.promise};e.transformf=function(a,b){return function(c){return e.transform(c,a,b)}};e.f=function(a){return function(){return e(a)}};e.all=function(a){return function(b){return c.allResolved(a.map(function(a){return a(b)})).then(function(a){a=a.filter(function(a){return c.isRejected(a)});
return a.length?c.reject(a):b})}};e._T=d;return e}()});
